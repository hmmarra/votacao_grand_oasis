<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Pautas de Votação</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script>window.jQuery || document.write('<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"><\/script>');</script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>if (!window.tailwind) { document.write('<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.css">'); }</script>
</head>
<body>
  <div class="min-h-screen bg-gradient-to-br from-indigo-50 to-purple-50 py-6 sm:py-10 px-3 sm:px-4 text-sm sm:text-base">
    <div class="max-w-4xl mx-auto">
      <!-- Header -->
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4 mb-6">
        <div class="flex items-center gap-3">
          <div class="p-2 rounded-xl bg-indigo-100 text-indigo-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor">
              <path fill-rule="evenodd" d="M2.25 12c0-2.248 0-4.122.116-5.527.119-1.44.36-2.527 1.035-3.388.676-.86 1.63-1.354 3.098-1.79C7.98.854 9.81.56 12 .56c2.19 0 4.019.294 5.501.736 1.469.436 2.422.93 3.098 1.79.676.861.916 1.948 1.035 3.388.116 1.405.116 3.279.116 5.527 0 2.248 0 4.123-.116 5.528-.119 1.44-.36 2.527-1.035 3.387-.676.862-1.63 1.356-3.098 1.792-1.482.441-3.311.735-5.501.735-2.19 0-4.02-.294-5.501-.735-1.469-.436-2.422-.93-3.098-1.792-.676-.86-.916-1.947-1.035-3.387C2.25 16.123 2.25 14.248 2.25 12Zm12.53-2.03a.75.75 0 0 0-1.06-1.06L11 11.62l-.72-.72a.75.75 0 1 0-1.06 1.06l1.25 1.25a.75.75 0 0 0 1.06 0l3.25-3.25Z" clip-rule="evenodd"/>
            </svg>
          </div>
          <div>
            <h1 class="text-2xl font-semibold text-gray-800">Pautas de Votação</h1>
            <p class="text-sm text-gray-500">Escolha uma pauta para votar</p>
          </div>
        </div>
        <button id="btnAdmin" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 rounded-lg bg-violet-600 text-white px-5 py-3 hover:bg-violet-700 text-base h-12">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 24 24" fill="currentColor">
            <path fill-rule="evenodd" d="M12 1.5a5.25 5.25 0 0 0-5.25 5.25v3a3 3 0 0 0-3 3v6.75a3 3 0 0 0 3 3h10.5a3 3 0 0 0 3-3v-6.75a3 3 0 0 0-3-3v-3c0-2.9-2.35-5.25-5.25-5.25Zm3.75 8.25v-3a3.75 3.75 0 1 0-7.5 0v3h7.5Z" clip-rule="evenodd"/>
          </svg>
          Admin
        </button>
      </div>

      <!-- Loading -->
      <div id="loading" class="text-center py-12">
        <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-indigo-600"></div>
        <p class="mt-4 text-gray-600">Carregando pautas...</p>
      </div>

      <!-- Empty State -->
      <div id="emptyState" class="hidden bg-white rounded-2xl shadow p-8 text-center">
        <svg xmlns="http://www.w3.org/2000/svg" class="mx-auto h-12 w-12 text-gray-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
        </svg>
        <h3 class="mt-4 text-lg font-medium text-gray-900">Nenhuma pauta disponível</h3>
        <p class="mt-2 text-sm text-gray-500">Não há pautas com status "Votação Liberada" no momento.</p>
      </div>

      <!-- Pautas List -->
      <div id="pautasList" class="hidden grid grid-cols-1 md:grid-cols-2 gap-4"></div>

      <p id="message" class="hidden mt-4 text-sm text-center"></p>
    </div>
  </div>

  <script>
    function navigateTo(view, tipo) {
      try {
        google.script.run.withSuccessHandler(function(base){
          var url = base || '';
          var params = [];
          if (view) params.push('view=' + encodeURIComponent(view));
          if (tipo) params.push('tipo=' + encodeURIComponent(tipo));
          if (params.length > 0) {
            url += (url.indexOf('?') === -1 ? '?' : '&') + params.join('&');
          }
          window.top.location.href = url || ('?' + params.join('&'));
        }).getWebAppUrl();
      } catch (e) {
        var params = [];
        if (view) params.push('view=' + view);
        if (tipo) params.push('tipo=' + tipo);
        var a = document.createElement('a');
        a.href = params.length > 0 ? ('?' + params.join('&')) : '?';
        a.target = '_top';
        document.body.appendChild(a);
        a.click();
        a.remove();
      }
    }

    function renderPautas(pautas) {
      if (!pautas || pautas.length === 0) {
        $('#loading').addClass('hidden');
        $('#emptyState').removeClass('hidden');
        return;
      }

      var html = '';
      pautas.forEach(function(pauta){
        html += '<div class="bg-white rounded-xl shadow hover:shadow-lg transition-shadow p-6 cursor-pointer pauta-card" data-aba="' + pauta.aba + '">' +
          '<div class="flex items-start justify-between mb-3">' +
            '<h3 class="text-lg font-semibold text-gray-800">' + pauta.nomePauta + '</h3>' +
            '<span class="px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800">Liberada</span>' +
          '</div>' +
          '<p class="text-sm text-gray-600 mb-4">' + pauta.descricao + '</p>' +
          '<div class="flex flex-wrap gap-2">';
        pauta.opcoes.forEach(function(opcao){
          html += '<span class="px-3 py-1 text-xs font-medium rounded-full bg-indigo-100 text-indigo-700">' + opcao + '</span>';
        });
        html += '</div>' +
          '<div class="mt-4 pt-4 border-t border-gray-200">' +
            '<button class="w-full inline-flex items-center justify-center gap-2 rounded-lg bg-indigo-600 text-white px-4 py-2 hover:bg-indigo-700 text-sm font-medium">' +
              '<svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" viewBox="0 0 24 24" fill="currentColor">' +
                '<path fill-rule="evenodd" d="M2.25 12c0-2.248 0-4.122.116-5.527.119-1.44.36-2.527 1.035-3.388.676-.86 1.63-1.354 3.098-1.79C7.98.854 9.81.56 12 .56c2.19 0 4.019.294 5.501.736 1.469.436 2.422.93 3.098 1.79.676.861.916 1.948 1.035 3.388.116 1.405.116 3.279.116 5.527 0 2.248 0 4.123-.116 5.528-.119 1.44-.36 2.527-1.035 3.387-.676.862-1.63 1.356-3.098 1.792-1.482.441-3.311.735-5.501.735-2.19 0-4.02-.294-5.501-.735-1.469-.436-2.422-.93-3.098-1.792-.676-.86-.916-1.947-1.035-3.387C2.25 16.123 2.25 14.248 2.25 12Zm12.53-2.03a.75.75 0 0 0-1.06-1.06L11 11.62l-.72-.72a.75.75 0 1 0-1.06 1.06l1.25 1.25a.75.75 0 0 0 1.06 0l3.25-3.25Z" clip-rule="evenodd"/>' +
              '</svg>' +
              'Votar Agora' +
            '</button>' +
          '</div>' +
        '</div>';
      });
      $('#pautasList').html(html);
      $('#loading').addClass('hidden');
      $('#pautasList').removeClass('hidden');
    }

    function loadPautas() {
      google.script.run
        .withSuccessHandler(function(pautas){
          renderPautas(pautas);
        })
        .withFailureHandler(function(e){
          $('#loading').addClass('hidden');
          $('#message').removeClass('hidden').addClass('text-red-600').text('Erro ao carregar pautas: ' + (e && e.message ? e.message : e));
        })
        .getPautas();
    }

    $(function(){
      $('#btnAdmin').on('click', function(){
        navigateTo('login');
      });

      $(document).on('click', '.pauta-card', function(){
        var aba = $(this).data('aba');
        navigateTo('index', aba);
      });

      loadPautas();
    });
  </script>
</body>
</html>

