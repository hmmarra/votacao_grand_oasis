<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Placar Subsíndico</title>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div class="min-h-screen bg-gray-50 py-6 sm:py-10 px-3 sm:px-4 text-[17px] sm:text-base">
    <div class="max-w-3xl mx-auto">
      <div class="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3 mb-4 sm:mb-6">
        <div class="flex items-center gap-3">
          <div class="p-2 rounded-xl bg-sky-100 text-sky-700">
            <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6" viewBox="0 0 24 24" fill="currentColor"><path d="M3.75 3a.75.75 0 0 1 .75.75v15a.75.75 0 1 1-1.5 0v-15A.75.75 0 0 1 3.75 3ZM9 9.75A1.75 1.75 0 0 1 10.75 8h.5A1.75 1.75 0 0 1 13 9.75v8.5A1.75 1.75 0 0 1 11.25 20h-.5A1.75 1.75 0 0 1 9 18.25v-8.5Zm6-5A1.75 1.75 0 0 1 16.75 3h.5A1.75 1.75 0 0 1 19 4.75v13.5A1.75 1.75 0 0 1 17.25 20h-.5A1.75 1.75 0 0 1 15 18.25V4.75Z"/></svg>
          </div>
          <div>
            <h1 class="text-2xl font-semibold text-gray-800 leading-snug">Placar Subsíndico</h1>
            <p class="text-sm text-gray-500">Acompanhe os votos computados.</p>
          </div>
        </div>
        <button id="btnVoltar" class="w-full sm:w-auto inline-flex items-center justify-center gap-2 rounded-lg bg-indigo-600 text-white px-5 py-3 hover:bg-indigo-700 text-base h-12">Voltar</button>
      </div>

      <div class="bg-white rounded-2xl shadow p-4 sm:p-6">
        <div id="cards" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-3 sm:gap-4"></div>
        <p id="total" class="mt-6 text-sm text-gray-600"></p>
        <p id="erro" class="mt-4 text-sm text-red-600 hidden"></p>
      </div>
    </div>
  </div>

  <script>
    function render(scores){
      var counts = scores.counts || {}; var total = scores.total || 0;
      var names = Object.keys(counts);
      var html='';
      if (!names.length) { html = '<div class="text-sm text-gray-500">Nenhum voto computado.</div>'; }
      names.forEach(function(n){
        var c = counts[n] || 0; var pct = total ? Math.round(c*100/total) : 0;
        html += '<div class="rounded-xl border border-gray-100 p-4">'
             + '<div class="flex items-center justify-between mb-2">'
             +   '<span class="font-medium text-gray-800">'+ n +'</span>'
             +   '<span class="text-sm text-gray-500">'+ c +' voto(s)</span>'
             + '</div>'
             + '<div class="w-full h-3 bg-gray-100 rounded-full overflow-hidden">'
             +   '<div class="h-3 bg-gradient-to-r from-emerald-500 to-teal-500" style="width:'+ pct +'%"></div>'
             + '</div>'
             + '<div class="mt-1 text-xs text-gray-500">'+ pct +'%</div>'
             + '</div>';
      });
      $('#cards').html(html);
      $('#total').text('Total de votos: ' + total);
    }
    function load(){
      google.script.run.withSuccessHandler(render).withFailureHandler(function(e){
        $('#erro').removeClass('hidden').text('Erro ao carregar placar: ' + (e && e.message ? e.message : e));
      }).getSubScores();
    }
    function back(){
      try { google.script.run.withSuccessHandler(function(base){ window.top.location.href = base + '?view=subsindico'; }).getWebAppUrl(); }
      catch(e){ window.location.search='?view=subsindico'; }
    }
    $(function(){ load(); setInterval(load, 5000); $('#btnVoltar').on('click', back); });
  </script>
</body>
</html>

